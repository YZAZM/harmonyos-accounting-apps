import { router } from '@kit.ArkUI';
import { common } from '@kit.AbilityKit';
import { BusinessError } from '@kit.BasicServicesKit';

@Entry
@Component
struct Settings {
  @State autoRecordEnabled: boolean = false;
  @State floatingWindowEnabled: boolean = true;
  @State isAccessibilityEnabled: boolean = false;

  aboutToAppear() {
    // æ£€æŸ¥æ— éšœç¢æœåŠ¡çŠ¶æ€
    this.checkAccessibilityStatus();
  }

  // æ£€æŸ¥æ— éšœç¢æœåŠ¡æ˜¯å¦å¼€å¯
  checkAccessibilityStatus() {
    // å®é™…å®ç°éœ€è¦è°ƒç”¨ç³»ç»ŸAPIæ£€æŸ¥
    this.isAccessibilityEnabled = false;
  }

  // è·³è½¬åˆ°æ— éšœç¢è®¾ç½®
  openAccessibilitySettings() {
    const context = getContext(this) as common.UIAbilityContext;
    const want: Want = {
      action: 'action.settings.accessibility'
    };
    context.startAbility(want).catch((err: BusinessError) => {
      console.error('æ‰“å¼€æ— éšœç¢è®¾ç½®å¤±è´¥:', JSON.stringify(err));
    });
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('ï¼œ')
          .fontSize(24)
          .fontColor('#666666')
          .onClick(() => {
            router.back();
          })
        
        Text('è®¾ç½®')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#1A1A1A')
        
        Blank()
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })

      Scroll() {
        Column({ space: 16 }) {
          // è‡ªåŠ¨è®°è´¦åŠŸèƒ½åŒº
          this.AutoRecordSection()

          // æ•°æ®ç®¡ç†åŒº
          this.DataManagementSection()

          // å…³äºåº”ç”¨
          this.AboutSection()
        }
        .width('100%')
        .padding(16)
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F5F5')
  }

  @Builder
  AutoRecordSection() {
    Column({ space: 12 }) {
      Text('è‡ªåŠ¨è®°è´¦')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1A1A1A')
        .alignSelf(ItemAlign.Start)
      
      Column({ space: 0 }) {
        // è‡ªåŠ¨è®°è´¦å¼€å…³
        Row() {
          Column({ space: 2 }) {
            Text('å¼€å¯è‡ªåŠ¨è®°è´¦')
              .fontSize(15)
              .fontColor('#1A1A1A')
            
            Text('è‡ªåŠ¨è¯†åˆ«æ”¯ä»˜é¡µé¢å¹¶å¼¹å‡ºç¡®è®¤')
              .fontSize(12)
              .fontColor('#999999')
          }
          .alignItems(HorizontalAlign.Start)
          
          Blank()
          
          Toggle({ type: ToggleType.Switch, isOn: this.autoRecordEnabled })
            .selectedColor('#4CAF50')
            .onChange((isOn: boolean) => {
              this.autoRecordEnabled = isOn;
              if (isOn && !this.isAccessibilityEnabled) {
                // æç¤ºå¼€å¯æ— éšœç¢æœåŠ¡
                this.openAccessibilitySettings();
              }
            })
        }
        .width('100%')
        .height(60)
        .padding({ left: 16, right: 16 })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // æ— éšœç¢æœåŠ¡çŠ¶æ€
        Row() {
          Column({ space: 2 }) {
            Text('æ— éšœç¢æœåŠ¡')
              .fontSize(15)
              .fontColor('#1A1A1A')
            
            Text(this.isAccessibilityEnabled ? 'å·²å¼€å¯' : 'æœªå¼€å¯')
              .fontSize(12)
              .fontColor(this.isAccessibilityEnabled ? '#4CAF50' : '#FF5722')
          }
          .alignItems(HorizontalAlign.Start)
          
          Blank()
          
          if (!this.isAccessibilityEnabled) {
            Text('å»å¼€å¯ ï¼')
              .fontSize(13)
              .fontColor('#4CAF50')
              .onClick(() => {
                this.openAccessibilitySettings();
              })
          }
        }
        .width('100%')
        .height(60)
        .padding({ left: 16, right: 16 })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // æ‚¬æµ®çª—å¼€å…³
        Row() {
          Column({ space: 2 }) {
            Text('æ‚¬æµ®ç¡®è®¤çª—')
              .fontSize(15)
              .fontColor('#1A1A1A')
            
            Text('æ”¯ä»˜åå¼¹å‡ºç¡®è®¤çª—å£')
              .fontSize(12)
              .fontColor('#999999')
          }
          .alignItems(HorizontalAlign.Start)
          
          Blank()
          
          Toggle({ type: ToggleType.Switch, isOn: this.floatingWindowEnabled })
            .selectedColor('#4CAF50')
            .onChange((isOn: boolean) => {
              this.floatingWindowEnabled = isOn;
            })
        }
        .width('100%')
        .height(60)
        .padding({ left: 16, right: 16 })
      }
      .width('100%')
      .backgroundColor('#FFFFFF')
      .borderRadius(12)
      .clip(true)

      // æç¤ºä¿¡æ¯
      Row({ space: 8 }) {
        Text('ğŸ’¡')
          .fontSize(16)
        
        Text('è‡ªåŠ¨è®°è´¦éœ€è¦å¼€å¯æ— éšœç¢æœåŠ¡å’Œæ‚¬æµ®çª—æƒé™æ‰èƒ½æ­£å¸¸å·¥ä½œ')
          .fontSize(12)
          .fontColor('#999999')
          .layoutWeight(1)
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#FFF9E6')
      .borderRadius(8)
    }
    .width('100%')
  }

  @Builder
  DataManagementSection() {
    Column({ space: 12 }) {
      Text('æ•°æ®ç®¡ç†')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1A1A1A')
        .alignSelf(ItemAlign.Start)
      
      Column({ space: 0 }) {
        // æ•°æ®å¯¼å‡º
        Row() {
          Text('å¯¼å‡ºæ•°æ®')
            .fontSize(15)
            .fontColor('#1A1A1A')
          
          Blank()
          
          Text('ï¼')
            .fontSize(16)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })
        .onClick(() => {
          // å¯¼å‡ºæ•°æ®é€»è¾‘
        })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // æ•°æ®å¯¼å…¥
        Row() {
          Text('å¯¼å…¥æ•°æ®')
            .fontSize(15)
            .fontColor('#1A1A1A')
          
          Blank()
          
          Text('ï¼')
            .fontSize(16)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })
        .onClick(() => {
          // å¯¼å…¥æ•°æ®é€»è¾‘
        })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // æ¸…é™¤æ•°æ®
        Row() {
          Text('æ¸…é™¤æ‰€æœ‰æ•°æ®')
            .fontSize(15)
            .fontColor('#FF5722')
          
          Blank()
          
          Text('ï¼')
            .fontSize(16)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })
        .onClick(() => {
          // æ¸…é™¤æ•°æ®é€»è¾‘
        })
      }
      .width('100%')
      .backgroundColor('#FFFFFF')
      .borderRadius(12)
      .clip(true)
    }
    .width('100%')
  }

  @Builder
  AboutSection() {
    Column({ space: 12 }) {
      Text('å…³äº')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#1A1A1A')
        .alignSelf(ItemAlign.Start)
      
      Column({ space: 0 }) {
        // ç‰ˆæœ¬ä¿¡æ¯
        Row() {
          Text('ç‰ˆæœ¬å·')
            .fontSize(15)
            .fontColor('#1A1A1A')
          
          Blank()
          
          Text('1.0.0')
            .fontSize(14)
            .fontColor('#999999')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // éšç§æ”¿ç­–
        Row() {
          Text('éšç§æ”¿ç­–')
            .fontSize(15)
            .fontColor('#1A1A1A')
          
          Blank()
          
          Text('ï¼')
            .fontSize(16)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })

        Divider()
          .color('#F0F0F0')
          .margin({ left: 16, right: 16 })

        // ç”¨æˆ·åè®®
        Row() {
          Text('ç”¨æˆ·åè®®')
            .fontSize(15)
            .fontColor('#1A1A1A')
          
          Blank()
          
          Text('ï¼')
            .fontSize(16)
            .fontColor('#CCCCCC')
        }
        .width('100%')
        .height(56)
        .padding({ left: 16, right: 16 })
      }
      .width('100%')
      .backgroundColor('#FFFFFF')
      .borderRadius(12)
      .clip(true)
    }
    .width('100%')
  }
}
